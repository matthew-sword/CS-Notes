## NMAP TCP扫描类型

### TCP SYN 扫描 （-sS）
TCP SYN 扫描是默认的 NMAP 扫描方式。为了运行 TCP SYN 扫描，需要有 Root 权限。TCP SYN 扫描的目的是找到被扫描系统上的已开启端口。使用 NMAP 扫描可以扫描在防火墙另一侧的系统。当扫描通过防火墙时，扫描时间会延长，因为数据包会变慢。

TCP SYN 扫描通过执行下面的步骤来进行工作：
1.  源系统向目标系统发送一个同步请求，该请求中包含一个端口号。
2. 如果添加在上一步中的所请求的端口号是开启的，那么目标系统将通过同步/应答（SYN/ACK）来响应源系统。
3. 源系统通过重置（RST）来响应目标系统，从而断开连接。
4. 目标系统可以通过重置/应答（RST/ACK）来响应源系统。

TCP SYN 扫描三次握手就没有完成，无法建立正常的TCP连接，因此，这次扫描就不会被记录到系统日志中。这种扫描技术一般不会在目标主机上留下扫描痕迹

### TCP Connect() 扫描 （-sT）
尽管 TCP SYN 扫描需要 Root 权限，但 TCP Connect() 扫描并不需要。在这种扫描中会执行一个完整的“三次握手”。因为不需要 Root 权限，所以在无法获取 Root 权限的网络上，这种扫描非常有用。

TCP Connect() 扫描的工作方式也是执行“三次握手”。正如上面描述过的，“三次握手”发生在两个系统之间。源系统发送一个同步（SYN）请求到目标系统。然后，目标系统将通过同步／应答（SYN/ACK）来响应。最后，源系统通过应答（ACK）来响应，从而建立起连接，然后便可在两个系统之间传输数据。

TCP Connect 扫描通过执行下面的步骤来工作：

1. 源系统发送一个同步（SYN）请求到目标系统，该请求中包含一个端口号。
2. 如果上一步所请求的端口是开启的，那么目标系统将通过同步/应答（SYN/ACK）来响应源系统。
3. 源系统通过应答（ACK）来响应目标系统从而完成会话创建。
4. 然后，源系统向目标系统发送一个重置（RST）包来关闭会话。
5. 目标系统可以通过同步/应答（SYN/ACK）来响应源系统。

### TCP MULL 扫描
反向扫描----原理是将一个没有设置任何标志位的数据包发送给TCP端口，在正常的通信中至少要设置一个标志位，根据FRC 793的要求，在端口关闭的情况下，若收到一个没有设置标志位的数据字段，那么主机应该舍弃这个分段，并发送一个RST数据包，否则不会响应发起扫描的客户端计算机。也就是说，如果TCP端口处于关闭则响应一个RST数据包，若处于开放则无相应。但是应该知道理由NULL扫描要求所有的主机都符合RFC 793规定，但是windows系统主机不遵从RFC 793标准，且只要收到没有设置任何标志位的数据包时，不管端口是处于开放还是关闭都响应一个RST数据包。但是基于Unix(*nix,如Linux)遵从RFC 793标准，所以可以用NULL扫描。   经过上面的分析，我们知道NULL可以辨别某台主机运行的操作系统是什么操作系统，是为windows呢？还是Unix？

### TCP ACK 扫描
扫描主机向目标主机发送ACK数据包。根据返回的RST数据包有两种方法可以得到端口的信息。方法一是： 若返回的RST数据包的TTL值小于或等于64，则端口开放，反之端口关闭，如图所示。

## XSS简介
XSS攻击：跨站脚本攻击(Cross-Site Scripting)是指攻击者往Web页面中插入恶意的Script代码，当其他用户浏览该页面是，恶意代码就会执行，从而达到攻击用户的目的。一般xss漏洞是通过php的输出函数将js代码输出到html页面，通过用户本地浏览器进行执行。
XSS漏洞一般分为两类：
1. 存储型XSS(持久化)：主要出现在让用户输入数据，供其他浏览此页的用户进行查看的地方，包括留言、评论、博客日志和各类表单等，攻击者在相关页面输入脚本代码，当其他用户访问时，服务器会从数据库中查询到该代码并发送给其他用户的浏览器。
2. 反射型XSS(非持久化)：将脚本代码加入URL中，需要欺骗用户去点击链接才会触发脚本

### XSS防御
1. 过滤特殊字符：对用户输入的内容中的敏感字段进行过滤，比如`<script>`标签等
2. 使用HTTP头指定数据类型，比如指定为`text/javascript`,就可以让浏览器来解析js代码

## CSRF
CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。

用大白话解释解释就是在你访问恶意站点A的时候，A让你去访问一次网站B，你在访问B的时候浏览器会自动带上你之前访问A所留下的cookie，这样恶意网站A就可以模拟用户的操作了。

### 防御方法-同源策略
同源策略是保障浏览器安全的一种重要的安全策略，他要求不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源。而同源策略在我们进行Web开发时会导致跨域问题

## XXE（外部实体攻击）
 XXE（XML External Entity）是指xml外部实体攻击漏洞。XML外部实体攻击是针对解析XML输入的应用程序的一种攻击。当包含对外部实体的引用的XML输入被弱配置XML解析器处理时，就会发生这种攻击。这种攻击通过构造恶意内容，可导致读取任意文件、执行系统命令、探测内网端口、攻击内网网站等危害。

### 外部实体：

外部实体表示外部文件的内容，用 SYSTEM 关键词表示，通常使用`<!DOCTYPE 根元素 SYSTEM “文件名”>`或者`<!DOCTYPE 根元素 PUBLIC “public_ID” “文件名”>`的形式引用外部实体。

## 会话劫持
会话劫持（Session hijacking），这是一种通过获取用户Session ID后，使用该Session ID登录目标账号的攻击方法，此时攻击者实际上是使用了目标账户的有效Session。会话劫持的第一步是取得一个合法的会话标识来伪装成合法用户，因此需要保证会话标识不被泄漏。

1. 目标用户需要先登录站点；

2. 登录成功后，该用户会得到站点提供的一个会话标识SessionID；

3. 攻击者通过某种攻击手段捕获Session ID；

4. 攻击者通过捕获到的Session ID访问站点即可获得目标用户合法会话。

### 防御方法
目前有三种广泛使用的在Web环境中维护会话（传递Session ID）的方法：URL参数，隐藏域和Cookie。其中每一种都各有利弊，Cookie已经被证明是三种方法中最方便最安全的。从安全的观点，如果不是全部也是绝大多数针对基于Cookie的会话管理机制的攻击对于URL或是隐藏域机制同样适用，但是反过来却不一定，这就让Cookie成为从安全考虑的最佳选择。

1. 更改Session名称。PHP中Session的默认名称是PHPSESSID，此变量会保存在Cookie中，如果攻击者不分析站点，就不能猜到Session名称，阻挡部分攻击。

2. 关闭透明化Session ID。透明化Session ID指当浏览器中的Http请求没有使用Cookie来存放Session ID时，Session ID则使用URL来传递。

3. 设置HttpOnly。通过设置Cookie的HttpOnly为true，可以防止客户端脚本访问这个Cookie，从而有效的防止XSS攻击。

4. 关闭所有phpinfo类dump request信息的页面。

5. 验证HTTP头部信息
 ## IPSec
 　IPSec(IP Security)产生于IPv6的制定之中，用于提供IP层的安全性。由于所有支持TCP/IP协议的主机进行通信时，都要经过IP层的处理，所以提供了IP层的安全性就相当于为整个网络提供了安全通信的基础。
 IPSec提供了两种安全机制：认证(采用ipsec的AH)和加密(采用ipsec的ESP)。

1. 认证机制使IP通信的数据接收方能够确认数据发送方的真实身份，以及数据在传输过程中是否遭篡改。
2. 加密机制通过对数据进行编码来保证数据的机密性，以防数据在传输过程中被窃听。

[参考链接](https://zhuanlan.zhihu.com/p/44874772)